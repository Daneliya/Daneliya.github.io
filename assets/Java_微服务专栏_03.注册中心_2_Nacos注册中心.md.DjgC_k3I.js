import{_ as a,c as i,o as n,aN as e}from"./chunks/framework.CMIDsdwV.js";const l="/assets/image-20210713230444308.Bu_xI9a3.png",p="/assets/image-20210713231439607.CqQVmFmy.png",t="/assets/image-20210713232522531.DIxWh-Og.png",r="/assets/image-20210713232658928.BStR9_j0.png",h="/assets/image-20210713232916215.DkdZ0QP8.png",c="/assets/image-20210713233528982.94wOn6h1.png",k="/assets/image-20210713233727923.CCy4TsUT.png",d="/assets/image-20210713235133225.CC8C_s11.png",o="/assets/image-20210713235235219.CSMPrmu5.png",g="/assets/image-20210714000101516.DOCB2N7n.png",E="/assets/image-20210714000414781.BDVNAfu9.png",m="/assets/image-20210714000440143.B3P6SOpd.png",u="/assets/image-20210714000505928.Dc2Dqexk.png",b="/assets/image-20210714000522913.CZC4aYz-.png",y="/assets/image-20210714000830703.ZcaBBzvT.png",v="/assets/image-20210714000837140.BpedEWbG.png",_="/assets/image-20210714000941256.BL40SNw8.png",A="/assets/image-20210714001728017.Cdc119E9.png",P=JSON.parse('{"title":"Nacos注册中心","description":"","frontmatter":{"title":"Nacos注册中心","date":"2022/10/02","permalink":"/java/mse/registry/nacos-introduce","tags":["Nacos"],"categories":["Nacos"]},"headers":[],"relativePath":"Java/微服务专栏/03.注册中心/2_Nacos注册中心.md","filePath":"Java/微服务专栏/03.注册中心/2_Nacos注册中心.md","lastUpdated":1768235883000}'),D={name:"Java/微服务专栏/03.注册中心/2_Nacos注册中心.md"};function C(f,s,F,N,q,x){return n(),i("div",null,[...s[0]||(s[0]=[e('<div style="display:none;" hidden="true" aria-hidden="true">Are you an LLM? You can read better optimized documentation at /Java\\微服务专栏\\03.注册中心\\2_Nacos注册中心.md for this page in Markdown format</div><h1 id="nacos注册中心" tabindex="-1">Nacos注册中心 <a class="header-anchor" href="#nacos注册中心" aria-label="Permalink to &quot;Nacos注册中心&quot;">​</a></h1><h2 id="一、认识和安装nacos" tabindex="-1">一、认识和安装Nacos <a class="header-anchor" href="#一、认识和安装nacos" aria-label="Permalink to &quot;一、认识和安装Nacos&quot;">​</a></h2><p><a href="https://nacos.io/" target="_blank" rel="noreferrer">Nacos</a>（Naming and Configuration Service）由阿里开源，是易于构建云原生应用的动态服务发现、配置管理和服务管理平台。它集成了服务注册与发现、配置中心、服务元数据管理等功能，是构建微服务架构的重要基础设施。</p><p>Nacos 现在是<a href="https://spring.io/projects/spring-cloud" target="_blank" rel="noreferrer">SpringCloud</a>中的一个组件。相比<a href="https://github.com/Netflix/eureka" target="_blank" rel="noreferrer">Eureka</a>功能更加丰富，在国内受欢迎程度较高。</p><p><img src="'+l+`" alt="image-20210713230444308" loading="lazy"></p><h2 id="二、服务注册到nacos" tabindex="-1">二、服务注册到nacos <a class="header-anchor" href="#二、服务注册到nacos" aria-label="Permalink to &quot;二、服务注册到nacos&quot;">​</a></h2><p>Nacos是SpringCloudAlibaba的组件，而SpringCloudAlibaba也遵循SpringCloud中定义的服务注册、服务发现规范。因此使用Nacos和使用Eureka对于微服务来说，并没有太大区别。</p><p>主要差异在于：</p><ul><li>依赖不同</li><li>服务地址不同</li></ul><h3 id="_2-1-引入依赖" tabindex="-1">2.1.引入依赖 <a class="header-anchor" href="#_2-1-引入依赖" aria-label="Permalink to &quot;2.1.引入依赖&quot;">​</a></h3><p>在cloud-demo父工程的pom文件中的<code>&lt;dependencyManagement&gt;</code>中引入SpringCloudAlibaba的依赖：</p><div class="language-xml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;com.alibaba.cloud&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;spring-cloud-alibaba-dependencies&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;2.2.6.RELEASE&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;pom&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">scope</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;import&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">scope</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>然后在user-service和order-service中的pom文件中引入nacos-discovery依赖：</p><div class="language-xml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">&lt;!-- nacos客户端依赖包 --&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;com.alibaba.cloud&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p><strong>注意</strong>：如果之前使用了eureka，不要忘了注释掉eureka的依赖。</p></blockquote><h3 id="_2-2-配置nacos地址" tabindex="-1">2.2.配置nacos地址 <a class="header-anchor" href="#_2-2-配置nacos地址" aria-label="Permalink to &quot;2.2.配置nacos地址&quot;">​</a></h3><p>在user-service和order-service的application.yml中添加nacos地址：</p><div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spring</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  cloud</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    nacos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      server-addr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">localhost:8848</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p><strong>注意</strong>：如果之前使用了eureka，不要忘了注释掉eureka的地址</p></blockquote><h3 id="_2-3-重启" tabindex="-1">2.3.重启 <a class="header-anchor" href="#_2-3-重启" aria-label="Permalink to &quot;2.3.重启&quot;">​</a></h3><p>重启微服务后，登录nacos管理页面，可以看到微服务信息：</p><p><img src="`+p+'" alt="image-20210713231439607" loading="lazy"></p><h2 id="三、服务分级存储模型" tabindex="-1">三、服务分级存储模型 <a class="header-anchor" href="#三、服务分级存储模型" aria-label="Permalink to &quot;三、服务分级存储模型&quot;">​</a></h2><p>一个<strong>服务</strong>可以有多个<strong>实例</strong>，例如user-service，可以有:</p><ul><li>127.0.0.1:8081</li><li>127.0.0.1:8082</li><li>127.0.0.1:8083</li></ul><p>假如这些实例分布于全国各地的不同机房，例如：</p><ul><li>127.0.0.1:8081，在上海机房</li><li>127.0.0.1:8082，在上海机房</li><li>127.0.0.1:8083，在杭州机房</li></ul><p>Nacos就将同一机房内的实例 划分为一个<strong>集群</strong>。</p><p>也就是说，user-service是服务，一个服务可以包含多个集群，如杭州、上海，每个集群下可以有多个实例，形成分级模型，如图：</p><p><img src="'+t+'" alt="image-20210713232522531" loading="lazy"></p><p>微服务互相访问时，应该尽可能访问同集群实例，因为本地访问速度更快。当本集群内不可用时，才访问其它集群。例如：</p><p><img src="'+r+`" alt="image-20210713232658928" loading="lazy"></p><p>杭州机房内的order-service应该优先访问同机房的user-service。</p><h3 id="_3-1-给user-service配置集群" tabindex="-1">3.1.给user-service配置集群 <a class="header-anchor" href="#_3-1-给user-service配置集群" aria-label="Permalink to &quot;3.1.给user-service配置集群&quot;">​</a></h3><p>修改user-service的application.yml文件，添加集群配置：</p><div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spring</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  cloud</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    nacos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      server-addr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">localhost:8848</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      discovery</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        cluster-name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">HZ</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 集群名称</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>重启两个user-service实例后，我们可以在nacos控制台看到下面结果：</p><p><img src="`+h+'" alt="image-20210713232916215" loading="lazy"></p><p>我们再次复制一个user-service启动配置，添加属性：</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-Dserver.port</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=8083</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -Dspring.cloud.nacos.discovery.cluster-name=SH</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>配置如图所示：</p><p><img src="'+c+'" alt="image-20210713233528982" loading="lazy"></p><p>启动UserApplication3后再次查看nacos控制台：</p><p><img src="'+k+`" alt="image-20210713233727923" loading="lazy"></p><h3 id="_3-2-同集群优先的负载均衡" tabindex="-1">3.2.同集群优先的负载均衡 <a class="header-anchor" href="#_3-2-同集群优先的负载均衡" aria-label="Permalink to &quot;3.2.同集群优先的负载均衡&quot;">​</a></h3><p>默认的<code>ZoneAvoidanceRule</code>并不能实现根据同集群优先来实现负载均衡。</p><p>因此Nacos中提供了一个<code>NacosRule</code>的实现，可以优先从同集群中挑选实例。</p><p>1）给order-service配置集群信息</p><p>修改order-service的application.yml文件，添加集群配置：</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">spring:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  cloud:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    nacos:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      server-addr:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> localhost:8848</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      discovery:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        cluster-name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> HZ</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 集群名称</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>2）修改负载均衡规则</p><p>修改order-service的application.yml文件，修改负载均衡规则：</p><div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">userservice</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  ribbon</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    NFLoadBalancerRuleClassName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">com.alibaba.cloud.nacos.ribbon.NacosRule</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 负载均衡规则</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>详细负载均衡组件策略可参考：<a href="/java/mse/serviced-component.html">Ribbon负载均衡组件</a></p><p><a href="https://xie.infoq.cn/article/6b442ce0eea211e1653ec3baf" target="_blank" rel="noreferrer">Spring Cloud Ribbon 中的 7 种负载均衡策略</a></p><p><a href="https://www.cnblogs.com/mingforyou/p/15501867.html" target="_blank" rel="noreferrer">Spring Cloud Alibaba Nacos 负载均衡策略Ribbon配置</a></p><p><a href="https://blog.csdn.net/weixin_42684368/article/details/135241924" target="_blank" rel="noreferrer">nacos实现指定ribbon负载均衡策略的三种方式</a></p><h2 id="四、权重配置" tabindex="-1">四、权重配置 <a class="header-anchor" href="#四、权重配置" aria-label="Permalink to &quot;四、权重配置&quot;">​</a></h2><p>实际部署中会出现这样的场景：</p><p>服务器设备性能有差异，部分实例所在机器性能较好，另一些较差，我们希望性能好的机器承担更多的用户请求。</p><p>但默认情况下NacosRule是同集群内随机挑选，不会考虑机器的性能问题。</p><p>因此，Nacos提供了权重配置来控制访问频率，权重越大则访问频率越高。</p><p>在nacos控制台，找到user-service的实例列表，点击编辑，即可修改权重：</p><p><img src="`+d+'" alt="image-20210713235133225" loading="lazy"></p><p>在弹出的编辑窗口，修改权重：</p><p><img src="'+o+'" alt="image-20210713235235219" loading="lazy"></p><blockquote><p><strong>注意</strong>：如果权重修改为0，则该实例永远不会被访问</p></blockquote><h2 id="五、环境隔离" tabindex="-1">五、环境隔离 <a class="header-anchor" href="#五、环境隔离" aria-label="Permalink to &quot;五、环境隔离&quot;">​</a></h2><p>Nacos提供了namespace来实现环境隔离功能。</p><ul><li>nacos中可以有多个namespace</li><li>namespace下可以有group、service等</li><li>不同namespace之间相互隔离，例如不同namespace的服务互相不可见</li></ul><p><img src="'+g+'" alt="image-20210714000101516" loading="lazy"></p><h3 id="_5-1-创建namespace" tabindex="-1">5.1.创建namespace <a class="header-anchor" href="#_5-1-创建namespace" aria-label="Permalink to &quot;5.1.创建namespace&quot;">​</a></h3><p>默认情况下，所有service、data、group都在同一个namespace，名为public：</p><p><img src="'+E+'" alt="image-20210714000414781" loading="lazy"></p><p>我们可以点击页面新增按钮，添加一个namespace：</p><p><img src="'+m+'" alt="image-20210714000440143" loading="lazy"></p><p>然后，填写表单：</p><p><img src="'+u+'" alt="image-20210714000505928" loading="lazy"></p><p>就能在页面看到一个新的namespace：</p><p><img src="'+b+`" alt="image-20210714000522913" loading="lazy"></p><h3 id="_5-2-给微服务配置namespace" tabindex="-1">5.2.给微服务配置namespace <a class="header-anchor" href="#_5-2-给微服务配置namespace" aria-label="Permalink to &quot;5.2.给微服务配置namespace&quot;">​</a></h3><p>给微服务配置namespace只能通过修改配置来实现。</p><p>例如，修改order-service的application.yml文件：</p><div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spring</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  cloud</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    nacos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      server-addr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">localhost:8848</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      discovery</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        cluster-name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">HZ</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        namespace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">492a7d5d-237b-46a1-a99a-fa8e98e4b0f9</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 命名空间，填ID</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>重启order-service后，访问控制台，可以看到下面的结果：</p><p><img src="`+y+'" alt="image-20210714000830703" loading="lazy"></p><p><img src="'+v+'" alt="image-20210714000837140" loading="lazy"></p><p>此时访问order-service，因为namespace不同，会导致找不到userservice，控制台会报错：</p><p><img src="'+_+`" alt="image-20210714000941256" loading="lazy"></p><h2 id="六、nacos与eureka的区别" tabindex="-1">六、Nacos与Eureka的区别 <a class="header-anchor" href="#六、nacos与eureka的区别" aria-label="Permalink to &quot;六、Nacos与Eureka的区别&quot;">​</a></h2><p>Nacos的服务实例分为两种类型：</p><ul><li><p>临时实例：如果实例宕机超过一定时间，会从服务列表剔除，默认的类型。</p></li><li><p>非临时实例：如果实例宕机，不会从服务列表剔除，也可以叫永久实例。</p></li></ul><p>配置一个服务实例为永久实例：</p><div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spring</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  cloud</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    nacos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      discovery</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        ephemeral</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 设置为非临时实例</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Nacos和Eureka整体结构类似，服务注册、服务拉取、心跳等待，但是也存在一些差异：</p><p><img src="`+A+'" alt="image-20210714001728017" loading="lazy"></p><ul><li><p>Nacos与eureka的共同点</p><ul><li>都支持服务注册和服务拉取</li><li>都支持服务提供者心跳方式做健康检测</li></ul></li><li><p>Nacos与Eureka的区别</p><ul><li>Nacos支持服务端主动检测提供者状态：临时实例采用心跳模式，非临时实例采用主动检测模式</li><li>临时实例心跳不正常会被剔除，非临时实例则不会被剔除</li><li>Nacos支持服务列表变更的消息推送模式，服务列表更新更及时</li><li>Nacos集群默认采用AP方式，当集群中存在非临时实例时，采用CP模式；Eureka采用AP方式</li></ul></li></ul>',98)])])}const z=a(D,[["render",C]]);export{P as __pageData,z as default};
