import{_ as s,c as e,o as n,aN as i}from"./chunks/framework.CMIDsdwV.js";const l="/assets/cf05a5a5_1151004.C_vDX2UO.png",t="/assets/0081Kckwly1gkl533oq0xj30ww0pomzt.I8R1H4cQ.jpg",p="/assets/image-20240711102104024.oHwYuNCs.png",u=JSON.parse('{"title":"SkyWalking链路追踪","description":"","frontmatter":{"title":"SkyWalking链路追踪","permalink":"/java/framework/distributed/skyWalking","tags":["分布式监控","链路追踪","SkyWalking"],"categories":["分布式监控","链路追踪","SkyWalking"]},"headers":[],"relativePath":"Java/架构设计/分布式/06.分布式监控/3_SkyWalking.md","filePath":"Java/架构设计/分布式/06.分布式监控/3_SkyWalking.md","lastUpdated":1768492435000}'),r={name:"Java/架构设计/分布式/06.分布式监控/3_SkyWalking.md"};function h(k,a,o,c,d,g){return n(),e("div",null,[...a[0]||(a[0]=[i('<div style="display:none;" hidden="true" aria-hidden="true">Are you an LLM? You can read better optimized documentation at /Java\\架构设计\\分布式\\06.分布式监控\\3_SkyWalking.md for this page in Markdown format</div><h1 id="skywalking链路追踪" tabindex="-1">SkyWalking链路追踪 <a class="header-anchor" href="#skywalking链路追踪" aria-label="Permalink to &quot;SkyWalking链路追踪&quot;">​</a></h1><h2 id="一、简介" tabindex="-1">一、简介 <a class="header-anchor" href="#一、简介" aria-label="Permalink to &quot;一、简介&quot;">​</a></h2><h3 id="什么是链路追踪" tabindex="-1">什么是链路追踪 <a class="header-anchor" href="#什么是链路追踪" aria-label="Permalink to &quot;什么是链路追踪&quot;">​</a></h3><p>随着微服务分布式系统变得日趋复杂，越来越多的组件开始走向分布式化，如分布式服务、分布式数据库、分布式缓存等，使得后台服务构成了一种复杂的分布式网络。在服务能力提升的同时，复杂的网络结构也使问题定位更加困难。在一个请求在经过诸多服务过程中，出现了某一个调用失败的情况，查询具体的异常由哪一个服务引起的就变得十分抓狂，问题定位和处理效率是也会非常低。</p><p>分布式链路追踪就是将一次分布式请求还原成调用链路，将一次分布式请求的调用情况集中展示，比如各个服务节点上的耗时、请求具体到达哪台机器上、每个服务节点的请求状态等等。</p><blockquote><p>推荐阅读两篇文章：</p><p><a href="https://github.com/opentracing-contrib/opentracing-specification-zh" target="_blank" rel="noreferrer">《OpenTracing 官方标准 —— 中文版》</a></p><p>Google 论文 <a href="http://www.iocoder.cn/Fight/Dapper-translation/?self" target="_blank" rel="noreferrer">《Dapper，大规模分布式系统的跟踪系统》</a></p></blockquote><h3 id="为什么要使用链路追踪" tabindex="-1">为什么要使用链路追踪 <a class="header-anchor" href="#为什么要使用链路追踪" aria-label="Permalink to &quot;为什么要使用链路追踪&quot;">​</a></h3><p>链路追踪为分布式应用的开发者提供了完整的调用链路还原、调用请求量统计、链路拓扑、应用依赖分析等工具，可以帮助开发者快速分析和诊断分布式应用架构下的性能瓶颈，提高微服务时代下的开发诊断效率。</p><h3 id="skywalking-链路追踪" tabindex="-1">SkyWalking 链路追踪 <a class="header-anchor" href="#skywalking-链路追踪" aria-label="Permalink to &quot;SkyWalking 链路追踪&quot;">​</a></h3><blockquote><p>官网地址：<a href="https://skywalking.apache.org" target="_blank" rel="noreferrer">https://skywalking.apache.org</a></p><p>官方文档：<a href="https://github.com/apache/skywalking/tree/master/docs" target="_blank" rel="noreferrer">https://github.com/apache/skywalking/tree/master/docs</a></p><p><strong>中文</strong>文档：<a href="https://github.com/SkyAPM/document-cn-translation-of-skywalking" target="_blank" rel="noreferrer">https://github.com/SkyAPM/document-cn-translation-of-skywalking</a></p></blockquote><p><code>SkyWalking</code>是一个可观测性分析平台（Observability Analysis Platform 简称OAP）和应用性能管理系统（Application Performance Management 简称 APM）。</p><p>提供分布式链路追踪，服务网格（Service Mesh）遥测分析，度量（Metric）聚合和可视化一体化解决方案。</p><h3 id="skywalking-特点" tabindex="-1">SkyWalking 特点 <a class="header-anchor" href="#skywalking-特点" aria-label="Permalink to &quot;SkyWalking 特点&quot;">​</a></h3><ul><li>多语言自动探针，java，.Net Code ,Node.Js</li><li>多监控手段，语言探针和Service Mesh</li><li>轻量高效，不需要额外搭建大数据平台</li><li>模块化架构，UI ，存储《集群管理多种机制可选</li><li>支持警告</li><li>优秀的可视化效果。</li></ul><h3 id="整体架构" tabindex="-1">整体架构 <a class="header-anchor" href="#整体架构" aria-label="Permalink to &quot;整体架构&quot;">​</a></h3><p>下面是<code>SkyWalking</code>的架构图：</p><p><img src="'+l+'" alt="skywalking" loading="lazy"></p><p>整个架构，分成上、下、左、右四部分：</p><blockquote><p>考虑到让描述更简单，我们舍弃掉 Metric 指标相关，而着重在 Tracing 链路相关功能。</p></blockquote><ul><li>上部分 <strong>Agent</strong> ：负责从应用中，收集链路信息，发送给 SkyWalking OAP 服务器。目前支持 SkyWalking、Zikpin、Jaeger 等提供的 Tracing 数据信息。而我们目前采用的是，SkyWalking Agent 收集 SkyWalking Tracing 数据，传递给服务器。</li><li>下部分 <strong>SkyWalking OAP</strong> ：负责接收 Agent 发送的 Tracing 数据信息，然后进行分析(Analysis Core) ，存储到外部存储器( Storage )，最终提供查询( Query )功能。</li><li>右部分 <strong>Storage</strong> ：Tracing 数据存储。目前支持 ES、MySQL、Sharding Sphere、TiDB、H2 多种存储器。而我们目前采用的是 ES ，主要考虑是 SkyWalking 开发团队自己的生产环境采用 ES 为主。</li><li>左部分 <strong>SkyWalking UI</strong> ：负责提供控台，查看链路等等。</li></ul><h2 id="二、单机环境安装" tabindex="-1">二、单机环境安装 <a class="header-anchor" href="#二、单机环境安装" aria-label="Permalink to &quot;二、单机环境安装&quot;">​</a></h2><p><img src="'+t+`" alt="SkyWalking 单机环境" loading="lazy"></p><ul><li>第一步，搭建一个 Elasticsearch 服务。</li><li>第二步，下载 SkyWalking 软件包。</li><li>第三步，搭建一个 SkyWalking OAP 服务。</li><li>第四步，启动一个 Spring Boot 应用，并配置 SkyWalking Agent。</li><li>第五步，搭建一个 SkyWalking UI 服务。</li></ul><p>从地址<code>https://archive.apache.org/dist/skywalking/</code></p><p>或skywalking的官网<code>http://skywalking.apache.org/downloads</code></p><p>下载包，包的结构如下：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>skywalking</span></span>
<span class="line"><span>|-- agent     本地代理模块（探针）</span></span>
<span class="line"><span>|-- bin       收集启动脚本</span></span>
<span class="line"><span>|-- config    skywalking数据收集器配置，告警配置等</span></span>
<span class="line"><span>|-- config-examples</span></span>
<span class="line"><span>|-- LICENSE</span></span>
<span class="line"><span>|-- licenses</span></span>
<span class="line"><span>|-- NOTICE</span></span>
<span class="line"><span>|-- oap-libs</span></span>
<span class="line"><span>|-- README.txt</span></span>
<span class="line"><span>|-- tools</span></span>
<span class="line"><span>|-- webapp    数据展示UI服务，系统依赖展示，链路追踪</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="windows平台安装" tabindex="-1">Windows平台安装 <a class="header-anchor" href="#windows平台安装" aria-label="Permalink to &quot;Windows平台安装&quot;">​</a></h3><p>可以从下载地址下载<code>apache-skywalking-apm-$version.tar.gz</code>包。</p><p>Windows下载解压后（.tar.gz），直接点击<code>bin/startup.bat</code>就可以了，这个时候实际上是启动了两个项目，一个收集器，一个web页面。</p><h3 id="linux平台安装" tabindex="-1">Linux平台安装 <a class="header-anchor" href="#linux平台安装" aria-label="Permalink to &quot;Linux平台安装&quot;">​</a></h3><h4 id="下载" tabindex="-1">下载 <a class="header-anchor" href="#下载" aria-label="Permalink to &quot;下载&quot;">​</a></h4><p>如果数据是存储在elasticsearch，需要下载对应的版本，否则启动报错</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wget</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://archive.apache.org/dist/skywalking/8.7.0/apache-skywalking-apm-es7-8.7.0.tar.gz</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tar</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -xzvf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache-skywalking-apm-es7-8.7.0.tar.gz</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>修改配置</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apache-skywalking-apm-bin-es7/config</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> application.yml</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>修改存储类型</p><div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">storage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  selector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${SW_STORAGE:elasticsearch7}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>修改elasticsearch配置</p><div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">elasticsearch7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">   clusterNodes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${SW_STORAGE_ES_CLUSTER_NODES:localhost:9200}</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  #es7机器地址</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   #略，其他配置不用动</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">   user</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${SW_ES_USER:&quot;es账号&quot;}</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  #如果es开启认证，需要填账号密码，否则不动即可</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">   password</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${SW_ES_PASSWORD:&quot;es密码&quot;}</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #如果es开启认证，需要填账号密码，否则不动不动即可</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="启动收集器" tabindex="-1">启动收集器 <a class="header-anchor" href="#启动收集器" aria-label="Permalink to &quot;启动收集器&quot;">​</a></h4><p><code>skywalking</code>提供了一个可视化的监控平台.</p><p>启动skywalking收集器服务，启动脚本为<code>bin</code>目录下<code>startup.sh</code>.</p><p>webapp相关配置修改在<code>webapp</code>目录下<code>webapp.yml</code>.</p><p>安装好之后，在浏览器中访问默认地址：<a href="http://IP:8080" target="_blank" rel="noreferrer">http://IP:8080</a> 就可以访问了。</p><p><img src="`+p+'" alt="image-20240711102104024" loading="lazy"></p><h4 id="启动项目" tabindex="-1">启动项目 <a class="header-anchor" href="#启动项目" aria-label="Permalink to &quot;启动项目&quot;">​</a></h4><p>拷贝agent目录到所需位置，探针包含整个目录，不要改变目录结构，可修改<code>agent/config/agent.config</code>配置<code>agent.service_name=xxl-job</code>为自己的应用名，增加JVM启动参数<code>-javaagent:/.../skywalking-agent/skywalking-agent.jar</code>。参数值为skywalking-agent.jar的绝对路径</p><h3 id="docker安装" tabindex="-1">Docker安装 <a class="header-anchor" href="#docker安装" aria-label="Permalink to &quot;Docker安装&quot;">​</a></h3><p><a href="https://zhuanlan.zhihu.com/p/479291356" target="_blank" rel="noreferrer">https://zhuanlan.zhihu.com/p/479291356</a></p><h2 id="三、使用" tabindex="-1">三、使用 <a class="header-anchor" href="#三、使用" aria-label="Permalink to &quot;三、使用&quot;">​</a></h2><p>复制安装包目录中的agent目录到java程序所在的机器上，探针包含整个目录，不要改变目录结构，可修改<code>agent/config/agent.config</code>配置<code>agent.service_name=xxl-job</code>为自己的应用名，增加JVM启动参数</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-javaagent:/skywalking-agent.jar的绝对路径/skywalking-agent.jar</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -Dskywalking.agent.service_name=服务名</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -Dskywalking.collector.backend_service=上边安装的服务器ip:11800</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>例如</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">java</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -javaagent:/data/apache-skywalking-apm-bin-es7/agent/skywalking-agent.jar</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -Dskywalking.agent.namespace=dev</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -Dskywalking.agent.service_name=service-gateway</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -Dskywalking.collector.backend_service=127.0.0.1:11800</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -Dspring.profiles.active=dev</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -jar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /demo.jar</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>参考资料：</p><p><a href="https://skywalking.apache.org/zh/2020-04-19-skywalking-quick-start" target="_blank" rel="noreferrer">https://skywalking.apache.org/zh/2020-04-19-skywalking-quick-start</a></p><p>[1]. <a href="https://blog.csdn.net/chengqwertyuiop/article/details/125065633" target="_blank" rel="noreferrer">https://blog.csdn.net/chengqwertyuiop/article/details/125065633</a></p><p>[2]. <a href="http://doc.ruoyi.vip/ruoyi-cloud/cloud/skywalking.html" target="_blank" rel="noreferrer">http://doc.ruoyi.vip/ruoyi-cloud/cloud/skywalking.html</a></p><p>agent：<a href="https://zhuanlan.zhihu.com/p/483352555" target="_blank" rel="noreferrer">https://zhuanlan.zhihu.com/p/483352555</a></p><p>简介：<a href="https://blog.csdn.net/feiying0canglang/article/details/120319399" target="_blank" rel="noreferrer">https://blog.csdn.net/feiying0canglang/article/details/120319399</a></p><p><a href="https://www.cnblogs.com/swave/p/11347711.html" target="_blank" rel="noreferrer">https://www.cnblogs.com/swave/p/11347711.html</a></p><p><a href="https://juejin.cn/post/7379416139975589951?searchId=20240711111734E120A0E1DA0C45950289#heading-3" target="_blank" rel="noreferrer">https://juejin.cn/post/7379416139975589951?searchId=20240711111734E120A0E1DA0C45950289#heading-3</a></p><p><a href="https://juejin.cn/post/7330828921100861478?searchId=20240711111734E120A0E1DA0C45950289#heading-8" target="_blank" rel="noreferrer">https://juejin.cn/post/7330828921100861478?searchId=20240711111734E120A0E1DA0C45950289#heading-8</a></p>',65)])])}const y=s(r,[["render",h]]);export{u as __pageData,y as default};
