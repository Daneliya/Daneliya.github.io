import{_ as a,c as i,o as e,ah as n,al as t}from"./chunks/framework.D5cOWG0Y.js";const b=JSON.parse('{"title":"应用诊断利器Arthas","description":"","frontmatter":{"title":"应用诊断利器Arthas","tags":["JVM"],"categories":["JVM"]},"headers":[],"relativePath":"Java/JVM性能调优/JVM性能监控与调优/Arthas.md","filePath":"Java/JVM性能调优/JVM性能监控与调优/Arthas.md","lastUpdated":1755802517000}'),l={name:"Java/JVM性能调优/JVM性能监控与调优/Arthas.md"};function h(r,s,p,k,d,o){return e(),i("div",null,[...s[0]||(s[0]=[n('<p>官方文档：<a href="https://arthas.gitee.io/" target="_blank" rel="noreferrer">https://arthas.gitee.io/</a></p><h2 id="使用" tabindex="-1">使用 <a class="header-anchor" href="#使用" aria-label="Permalink to “使用”">​</a></h2><h3 id="从-maven-仓库下载" tabindex="-1">从 Maven 仓库下载 <a class="header-anchor" href="#从-maven-仓库下载" aria-label="Permalink to “从 Maven 仓库下载”">​</a></h3><p>最新版本，点击下载：<a href="https://arthas.aliyun.com/download/latest_version?mirror=aliyun" target="_blank" rel="noreferrer"><img src="'+t+`" alt="Arthas" loading="lazy"></a></p><h3 id="从-github-releases-页下载" tabindex="-1">从 Github Releases 页下载 <a class="header-anchor" href="#从-github-releases-页下载" aria-label="Permalink to “从 Github Releases 页下载”">​</a></h3><p><a href="https://github.com/alibaba/arthas/releases" target="_blank" rel="noreferrer">https://github.com/alibaba/arthas/releases</a></p><h3 id="用-as-sh-启动" tabindex="-1">用 as.sh 启动 <a class="header-anchor" href="#用-as-sh-启动" aria-label="Permalink to “用 as.sh 启动”">​</a></h3><p>解压后，在文件夹里有<code>as.sh</code>，直接用<code>./as.sh</code>的方式启动：</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./as.sh</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>打印帮助信息：</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./as.sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -h</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>或者直接下载启动脚本文件 <code>as.sh</code> 到当前目录，直接在 shell 下面执行<code>./as.sh</code>，就会进入交互界面</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -L</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://arthas.aliyun.com/install.sh</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sh</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="用-arthas-boot-启动" tabindex="-1">用 arthas-boot 启动 <a class="header-anchor" href="#用-arthas-boot-启动" aria-label="Permalink to “用 arthas-boot 启动”">​</a></h3><p>或者在解压后，在文件夹里有<code>arthas-boot.jar</code>，直接用<code>java -jar</code>的方式启动：</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">java</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -jar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> arthas-boot.jar</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>打印帮助信息：</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">java</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -jar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> arthas-boot.jar</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -h</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="实战" tabindex="-1">实战 <a class="header-anchor" href="#实战" aria-label="Permalink to “实战”">​</a></h2><p><a href="https://www.cnblogs.com/itxiaoshen/p/15854197.html" target="_blank" rel="noreferrer">https://www.cnblogs.com/itxiaoshen/p/15854197.html</a></p><p><a href="https://www.cnblogs.com/yaoyu1983/p/17373522.html" target="_blank" rel="noreferrer">https://www.cnblogs.com/yaoyu1983/p/17373522.html</a></p><p><a href="https://blog.csdn.net/weixin_40816738/article/details/123308455" target="_blank" rel="noreferrer">https://blog.csdn.net/weixin_40816738/article/details/123308455</a></p><p><a href="https://wenku.baidu.com/view/9b750a2fff4ffe4733687e21af45b307e871f91e.html?fr=sogou&amp;_wkts_=1694659165451" target="_blank" rel="noreferrer">https://wenku.baidu.com/view/9b750a2fff4ffe4733687e21af45b307e871f91e.html?fr=sogou&amp;_wkts_=1694659165451</a></p><p><a href="https://zhuanlan.zhihu.com/p/322094284" target="_blank" rel="noreferrer">https://zhuanlan.zhihu.com/p/322094284</a></p><h2 id="问题" tabindex="-1">问题 <a class="header-anchor" href="#问题" aria-label="Permalink to “问题”">​</a></h2><p>1、The telnet port 3658 is used by process 28221 instead of target process 96492, you will connect to an unexpected process</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ERROR] The telnet port 3658 is used by process 28221 instead of target process 96492, you will connect to an unexpected process.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ERROR] 1. Try to restart arthas-boot, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> process 28221, shutdown it first with running the ‘stop’ command.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ERROR] 2. Or try to stop the existing arthas instance: java -jar arthas-client.jar 127.0.0.1 3658 -c “stop”</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ERROR] 3. Or try to use different telnet port, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> example: java -jar arthas-boot.jar --telnet-port </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">9998</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --http-port </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-1</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>上次连接的进程，未正常退出。重新选择上次的连接，执行stop。</p><p>如果连接超时，查询端口进程，强制杀掉。</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">netstat</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -tln</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">netstat</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -tln</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 端口</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看端口被哪个进程占用</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lsof</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :端口</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 杀掉进程</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">kill</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -9</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 进程id</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>2、arthas报“Can not find java process”</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@iZm5e1egdpr5bckrj8gty5Z arthas]# sudo java -jar arthas-boot.jar</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[INFO] JAVA_HOME: /usr/lib/jvm/java-11-openjdk-11.0.21.0.9-2.0.3.al8.x86_64</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[INFO] arthas-boot version: 3.7.2</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[INFO] Can not find java process. Try to run </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">jps</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> command</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lists</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> instrumented</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Java</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> HotSpot</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> VMs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> on</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> target</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> system.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Please</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> select</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> an</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> available</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pid.</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>解决方式一：未使用root权限，sudo执行命令</p><p>解决方式二：找不到jps命令，默认安装的openjdk是不支持jps的，所以需要卸载Open JDK， 安装Oracle JDK：<a href="https://www.cnblogs.com/andy020/p/17511279.html" target="_blank" rel="noreferrer">https://www.cnblogs.com/andy020/p/17511279.html</a> or 安装关联包：<a href="https://blog.51cto.com/u_13890915/4653202" target="_blank" rel="noreferrer">https://blog.51cto.com/u_13890915/4653202</a></p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在提示的版本上增加 devel </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> java-11-openjdk-devel-11.0.21.0.9-2.0.3.al8.x86_64</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="参考" tabindex="-1">参考： <a class="header-anchor" href="#参考" aria-label="Permalink to “参考：”">​</a></h2><p><a href="https://www.cnblogs.com/lyn8100/p/17377845.html" target="_blank" rel="noreferrer">https://www.cnblogs.com/lyn8100/p/17377845.html</a></p><p><a href="https://zhuanlan.zhihu.com/p/519213445" target="_blank" rel="noreferrer">https://zhuanlan.zhihu.com/p/519213445</a></p><p><a href="https://www.bilibili.com/video/BV19k4y1k7o9/" target="_blank" rel="noreferrer">https://www.bilibili.com/video/BV19k4y1k7o9/</a></p><p><a href="https://zhuanlan.zhihu.com/p/584170583" target="_blank" rel="noreferrer">https://zhuanlan.zhihu.com/p/584170583</a></p><p><a href="https://www.cnblogs.com/jaigejiayou/p/15735690.html" target="_blank" rel="noreferrer">https://www.cnblogs.com/jaigejiayou/p/15735690.html</a></p><p><a href="https://zhuanlan.zhihu.com/p/429565721" target="_blank" rel="noreferrer">https://zhuanlan.zhihu.com/p/429565721</a></p>`,42)])])}const g=a(l,[["render",h]]);export{b as __pageData,g as default};
