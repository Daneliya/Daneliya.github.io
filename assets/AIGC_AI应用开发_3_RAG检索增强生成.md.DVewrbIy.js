import{_ as i,c as a,o as n,aN as e}from"./chunks/framework.CMIDsdwV.js";const l="/assets/RAG.8fpanJBh.gif",p="/assets/mY1SjfXTshOxqMLt.ByE1RoKf.webp",t="/assets/eYpl07AKdNneRjuL.DUVgP4OE.webp",r="/assets/bagqTEknnhZSss0F.C9hFGIbj.webp",h="/assets/tsQzX65NIpj7bMQb.Mzz1BIux.webp",k="/assets/oIbFEJ2kIr2ws57u.B352AEC1.webp",d="/assets/xTxeR971ObxC5qKk.B_TrLF4W.webp",E="/assets/vDsq55DUDXuyi9Qc.tptM6WyG.webp",g="/assets/2JeMTLWlu581TasX.DZK_S8dx.webp",o="/assets/3mqXRgFV7fgWnXrR.D0-uWQ0V.webp",c="/assets/nawyImkjvI2SSgBV.u8SXVzxY.webp",m="/assets/II5SKLmq3PBVUBzJ.gCxASXbq.webp",b="/assets/NCXVG8ioWsdV1QOf.Bs7d9or5.webp",y="/assets/EA2rRRx4W8BJ6UDW.CAXz85WV.webp",u="/assets/dyTCTOQSoVRoLRS7.DD8fD2ko.webp",A="/assets/vtIP781rWXGQcBIo.GI2w8I4R.webp",F="/assets/BkSPXZ2Sw3TkHU3U.CRe9uWEP.webp",_="/assets/FDlr0Q8zRudaheMR.CmtpTVOJ.webp",v="/assets/CV5pFfJtjDfjfaOx.0m4zWEVo.webp",D="/assets/ISWkkmfXWn81zjvv.DImjnPle.webp",C="/assets/yNRlEZQLfVDsW8sl.BkL4UUdr.webp",R="/assets/qUFJmwV2GmMBpV0u.C858RfWF.webp",f="/assets/rNeajWpyABQRhWm9.6Vokpssu.webp",w="/assets/vCtrbIAwGwah17eq.BSDPXq31.webp",I="/assets/JyMef0WvrrfUAbuj.Vei84dWa.webp",z=JSON.parse('{"title":"RAG 检索增强生成","description":"","frontmatter":{"title":"RAG 检索增强生成","date":"2026-02-06","permalink":"/aigc/development/rag","tags":["AI应用开发"],"categories":["AI应用开发"]},"headers":[],"relativePath":"AIGC/AI应用开发/3_RAG检索增强生成.md","filePath":"AIGC/AI应用开发/3_RAG检索增强生成.md","lastUpdated":1770370325000}'),B={name:"AIGC/AI应用开发/3_RAG检索增强生成.md"};function q(S,s,G,x,P,V){return n(),a("div",null,[...s[0]||(s[0]=[e('<div style="display:none;" hidden="true" aria-hidden="true">Are you an LLM? You can read better optimized documentation at /AIGC\\AI应用开发\\3_RAG检索增强生成.md for this page in Markdown format</div><h1 id="rag-检索增强生成" tabindex="-1">RAG 检索增强生成 <a class="header-anchor" href="#rag-检索增强生成" aria-label="Permalink to &quot;RAG 检索增强生成&quot;">​</a></h1><h2 id="一、前言" tabindex="-1">一、前言 <a class="header-anchor" href="#一、前言" aria-label="Permalink to &quot;一、前言&quot;">​</a></h2><p>首先 AI 原本就拥有一些通用的知识，对于不会的知识，还可以利用互联网搜索。但是这些都是从网络获取的、公开的知识。对于企业来说，数据是命脉，也是自己独特的价值，随着业务的发展，企业肯定会积累一波自己的知识库，如果让 AI 能够利用这些知识库进行问答，效果可能会更好，而且更加个性化。</p><p>如果不给 AI 提供特的知识库，AI 可能会面临这些问题：</p><ol><li>知识有限：AI 不知道你的最新课程和内容</li><li>编故事：当 AI 不知道答案时，它可能会 “自圆其说” 编造内容</li><li>无法个性化：不了解你的特色服务和回答风格</li><li>不会推销：不知道该在什么时候推荐你的付费课程和服务</li></ol><p>那么如何让 AI 利用自己的知识库进行问答呢？这就需要用到 AI 主流的技术 —— RAG。</p><h2 id="二、rag-概念" tabindex="-1">二、RAG 概念 <a class="header-anchor" href="#二、rag-概念" aria-label="Permalink to &quot;二、RAG 概念&quot;">​</a></h2><h3 id="什么是-rag" tabindex="-1">什么是 RAG？ <a class="header-anchor" href="#什么是-rag" aria-label="Permalink to &quot;什么是 RAG？&quot;">​</a></h3><p>RAG（Retrieval-Augmented Generation，检索增强生成）是一种结合信息检索技术和 AI 内容生成的混合架构，可以解决大模型的知识时效性限制和幻觉问题。</p><p>简单来说，RAG 就像给 AI 配了一个 “小抄本”，让 AI 回答问题前先查一查特定的知识库来获取知识，确保回答是基于真实资料而不是凭空想象。</p><p>从技术角度看，RAG 在大语言模型生成回答之前，会先从外部知识库中检索相关信息，然后将这些检索到的内容作为额外上下文提供给模型，引导其生成更准确、更相关的回答。</p><p>通过 RAG 技术改造后，AI 就能：</p><ul><li>准确回答关于特定内容的问题</li><li>在合适的时机推荐相关课程和服务</li><li>用特定的语气和用户交流</li><li>提供更新、更准确的建议</li></ul><p>可以简单了解下 RAG 和传统 AI 模型的区别：</p><table tabindex="0"><thead><tr><th>特性</th><th>传统大语言模型</th><th>RAG增强模型</th></tr></thead><tbody><tr><td>知识时效性</td><td>受训练数据截止日期限制</td><td>可接入最新知识库</td></tr><tr><td>领域专业性</td><td>泛化知识，专业深度有限</td><td>可接入专业领域知识</td></tr><tr><td>响应准确性</td><td>可能产生 “幻觉”</td><td>基于检索的事实依据</td></tr><tr><td>可控性</td><td>依赖原始训练</td><td>可通过知识库定制输出</td></tr><tr><td>资源消耗</td><td>较高（需要大模型参数）</td><td>模型可更小，结合外部知识</td></tr></tbody></table><p><img src="'+l+'" alt="RAG" loading="lazy"></p><h3 id="rag-工作流程" tabindex="-1">RAG 工作流程 <a class="header-anchor" href="#rag-工作流程" aria-label="Permalink to &quot;RAG 工作流程&quot;">​</a></h3><p>RAG 技术实现主要包含以下 4 个核心步骤：</p><ul><li>文档收集和切割</li><li>向量转换和存储</li><li>文档过滤和检索</li><li>查询增强和关联</li></ul><h4 id="_1、文档收集和切割" tabindex="-1">1、文档收集和切割 <a class="header-anchor" href="#_1、文档收集和切割" aria-label="Permalink to &quot;1、文档收集和切割&quot;">​</a></h4><p>文档收集：从各种来源（网页、PDF、数据库等）收集原始文档</p><p>文档预处理：清洗、标准化文本格式</p><p>文档切割：将长文档分割成适当大小的片段（俗称 chunks）</p><ul><li>基于固定大小（如 512 个 token）</li><li>基于语义边界（如段落、章节）</li><li>基于递归分割策略（如递归字符 n-gram 切割）</li></ul><p><img src="'+p+'" alt="img" loading="lazy"></p><h4 id="_2、向量转换和存储" tabindex="-1">2、向量转换和存储 <a class="header-anchor" href="#_2、向量转换和存储" aria-label="Permalink to &quot;2、向量转换和存储&quot;">​</a></h4><p>向量转换：使用 Embedding 模型将文本块转换为高维向量表示，可以捕获到文本的语义特征</p><p>向量存储：将生成的向量和对应文本存入向量数据库，支持高效的相似性搜索cLGytfopnrFuxnn3sz+3dYGbZsmkbigItBfA6ZV7hZU=</p><p><img src="'+t+'" alt="img" loading="lazy"></p><h4 id="_3、文档过滤和检索" tabindex="-1">3、文档过滤和检索 <a class="header-anchor" href="#_3、文档过滤和检索" aria-label="Permalink to &quot;3、文档过滤和检索&quot;">​</a></h4><p>查询处理：将用户问题也转换为向量表示</p><p>过滤机制：基于元数据、关键词或自定义规则进行过滤</p><p>相似度搜索：在向量数据库中查找与问题向量最相似的文档块，常用的相似度搜索算法有余弦相似度、欧氏距离等</p><p>上下文组装：将检索到的多个文档块组装成连贯上下文</p><p><img src="'+r+'" alt="img" loading="lazy"></p><h4 id="_4、查询增强和关联" tabindex="-1">4、查询增强和关联 <a class="header-anchor" href="#_4、查询增强和关联" aria-label="Permalink to &quot;4、查询增强和关联&quot;">​</a></h4><p>提示词组装：将检索到的相关文档与用户问题组合成增强提示                                nqebE0GbQps0Ats4MKJjbVHQiAAW+ffJdMrCsN5dgzs=</p><p>上下文融合：大模型基于增强提示生成回答</p><p>源引用：在回答中添加信息来源引用</p><p>后处理：格式化、摘要或其他处理以优化最终输出</p><p><img src="'+h+'" alt="img" loading="lazy"></p><h4 id="完整工作流程" tabindex="-1">完整工作流程 <a class="header-anchor" href="#完整工作流程" aria-label="Permalink to &quot;完整工作流程&quot;">​</a></h4><p>分别理解上述 4 个步骤后，我们可以将它们组合起来，形成完整的 RAG 检索增强生成工作流程：</p><p><img src="'+k+'" alt="img" loading="lazy"></p><p>上述工作流程中涉及了很多技术名词，让我们分别进行解释。</p><h3 id="rag-相关技术" tabindex="-1">RAG 相关技术 <a class="header-anchor" href="#rag-相关技术" aria-label="Permalink to &quot;RAG 相关技术&quot;">​</a></h3><h4 id="embedding-和-embedding-模型" tabindex="-1">Embedding 和 Embedding 模型 <a class="header-anchor" href="#embedding-和-embedding-模型" aria-label="Permalink to &quot;Embedding 和 Embedding 模型&quot;">​</a></h4><p>Embedding 嵌入是将高维离散数据（如文字、图片）转换为低维连续向量的过程。这些向量能在数学空间中表示原始数据的语义特征，使计算机能够理解数据间的相似性。</p><p>Embedding 模型是执行这种转换算法的<a href="https://www.mianshiya.com/bank/1821834636175642625" target="_blank" rel="noreferrer">机器学习</a>模型，如 Word2Vec（文本）、ResNet（图像）等。不同的 Embedding 模型产生的向量表示和维度数不同，一般维度越高表达能力更强，可以捕获更丰富的语义信息和更细微的差别，但同样占用更多存储空间</p><p>举个例子，“鱼皮” 和 “鱼肉” 的 Embedding 向量在空间中较接近，而 “鱼皮” 和 “帅哥” 则相距较远，反映了语义关系。</p><p><img src="'+d+'" alt="img" loading="lazy"></p><h4 id="向量数据库" tabindex="-1">向量数据库 <a class="header-anchor" href="#向量数据库" aria-label="Permalink to &quot;向量数据库&quot;">​</a></h4><p>向量数据库是专门存储和检索向量数据的数据库系统。通过高效索引算法实现快速相似性搜索，支持 K 近邻查询等操作。</p><p><img src="'+E+'" alt="img" loading="lazy"></p><p>注意，并不是只有向量数据库才能存储向量数据，只不过与传统数据库不同，向量数据库优化了高维向量的存储和检索。</p><p>AI 的流行带火了一波向量数据库和向量存储，比如 Milvus、Pinecone 等。此外，一些传统数据库也可以通过安装插件实现向量存储和检索，比如 PGVector、<a href="https://www.mianshiya.com/bank/1791375592078610434" target="_blank" rel="noreferrer">Redis</a> Stack 的 RediSearch 等。</p><p>用一张图来了解向量数据库的分类：</p><p><img src="'+g+'" alt="img" loading="lazy"></p><h4 id="召回" tabindex="-1">召回 <a class="header-anchor" href="#召回" aria-label="Permalink to &quot;召回&quot;">​</a></h4><p>召回是信息检索中的第一阶段，目标是从大规模数据集中快速筛选出可能相关的候选项子集。<strong>强调速度和广度，而非精确度。</strong></p><p>举个例子，我们要从搜索引擎查询 “编程导航-程序员一站式编程学习交流社区” 时，召回阶段会从数十亿网页中快速筛选出数千个含有 “编程”、“导航”、“程序员” 等相关内容的页面，为后续粗略排序和精细排序提供候选集。</p><h4 id="精排和-rank-模型" tabindex="-1">精排和 Rank 模型 <a class="header-anchor" href="#精排和-rank-模型" aria-label="Permalink to &quot;精排和 Rank 模型&quot;">​</a></h4><p>精排（精确排序）是搜索 / 推荐系统的最后阶段，使用计算复杂度更高的算法，考虑更多特征和业务规则，对少量候选项进行更复杂、精细的排序。</p><p>比如，短视频推荐先通过召回获取数万个可能相关视频，再通过粗排缩减至数百条，最后精排阶段会考虑用户最近的互动、视频热度、内容多样性等复杂因素，确定最终展示的 10 个视频及顺序。</p><p><img src="'+o+'" alt="img" loading="lazy"></p><p>Rank 模型（排序模型）负责对召回阶段筛选出的候选集进行精确排序，考虑多种特征评估相关性。</p><p>现代 Rank 模型通常基于<a href="https://www.mianshiya.com/bank/1821834656568348674" target="_blank" rel="noreferrer">深度学习</a>，如 BERT、LambdaMART 等，综合考虑查询与候选项的相关性、用户历史行为等因素。举个例子，电商推荐系统会根据商品特征、用户偏好、点击率等给每个候选商品打分并排序。</p><p><img src="'+c+'" alt="img" loading="lazy"></p><h4 id="混合检索策略" tabindex="-1">混合检索策略 <a class="header-anchor" href="#混合检索策略" aria-label="Permalink to &quot;混合检索策略&quot;">​</a></h4><p>混合检索策略结合多种检索方法的优势，提高搜索效果。常见组合包括关键词检索、语义检索、知识图谱等。</p><p>比如在 AI 大模型开发平台 Dify 中，就为用户提供了 “基于全文检索的关键词搜索 + 基于向量检索的语义检索” 的混合检索策略，用户还可以自己设置不同检索方式的权重。</p><p><img src="'+m+'" alt="img" loading="lazy"></p><p>💡 RAG 的工作流程和相关技术是面试时的重点，更多细节大家可以在 <a href="https://www.mianshiya.com/bank/1906189461556076546" target="_blank" rel="noreferrer">面试鸭最新的 AI 大模型题库</a> 中学习：</p><p><img src="'+b+'" alt="img" loading="lazy"></p><p>了解了 RAG 概念后，我们来学习如何利用编程开发实现 RAG。想要在程序中让 AI 使用知识库，首先建议利用一个 AI 开发框架，比如 Spring AI；然后可以通过 2 种模式进行开发 —— 基于本地知识库或云知识库服务实现 RAG。下面分别讲解这 2 种模式。</p><h2 id="三、rag-实战-spring-ai-本地知识库" tabindex="-1">三、RAG 实战：Spring AI + 本地知识库 <a class="header-anchor" href="#三、rag-实战-spring-ai-本地知识库" aria-label="Permalink to &quot;三、RAG 实战：Spring AI + 本地知识库&quot;">​</a></h2><p>Spring AI 框架为我们实现 RAG 提供了全流程的支持，参考 <a href="https://docs.spring.io/spring-ai/reference/api/retrieval-augmented-generation.html" target="_blank" rel="noreferrer">Spring AI</a> 和 <a href="https://java2ai.com/docs/1.0.0-M6.1/tutorials/rag/" target="_blank" rel="noreferrer">Spring AI Alibaba</a> 的官方文档。</p><p>由于是第一个 RAG 程序，我们参考标准的 RAG 开发步骤并进行一定的简化，来实现基于本地知识库的 AI 恋爱知识问答应用。</p><p>标准的 RAG 开发步骤：</p><ol><li>文档收集和切割</li><li>向量转换和存储</li><li>切片过滤和检索</li><li>查询增强和关联</li></ol><p>简化后的 RAG 开发步骤：</p><ol><li>文档准备</li><li>文档读取</li><li>向量转换和存储</li><li>查询增强</li></ol><h3 id="_1、文档准备" tabindex="-1">1、文档准备 <a class="header-anchor" href="#_1、文档准备" aria-label="Permalink to &quot;1、文档准备&quot;">​</a></h3><p>首先准备用于给 AI 知识库提供知识的文档，推荐 Markdown 格式，尽量结构化。</p><p>💡 大家在学习 RAG 的过程中，可以利用 AI 来生成文档，提供一段示例 Prompt：</p><div class="language-markdown vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">markdown</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">帮我生成 3 篇 Markdown 文章，主题是【恋爱常见问题和回答】，3 篇文章的问题分别针对单身、恋爱、已婚的状态，内容形式为 1 问 1 答，每个问题标题使用 4 级标题，每篇内容需要有至少 5 个问题，要求每个问题中推荐一个相关的课程，课程链接都是 https://luckilyxxl.top</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>生成 3 篇《恋爱常见问题和回答》文档，保存到资源目录下即可：</p><ul><li>📎恋爱常见问题和回答 - 单身篇</li><li>📎恋爱常见问题和回答 - 已婚篇</li><li>📎恋爱常见问题和回答 - 恋爱篇</li></ul><p><img src="'+y+'" alt="img" loading="lazy"></p><h3 id="_2、文档读取" tabindex="-1">2、文档读取 <a class="header-anchor" href="#_2、文档读取" aria-label="Permalink to &quot;2、文档读取&quot;">​</a></h3><p>首先，我们要对自己准备好的知识库文档进行处理，然后保存到向量数据库中。这个过程俗称 ETL（抽取、转换、加载），Spring AI 提供了对 ETL 的支持，参考 <a href="https://docs.spring.io/spring-ai/reference/api/etl-pipeline.html#_markdown" target="_blank" rel="noreferrer">官方文档</a>。</p><p>ETL 的 3 大核心组件，按照顺序执行：</p><ul><li>DocumentReader：读取文档，得到文档列表</li><li>DocumentTransformer：转换文档，得到处理后的文档列表</li><li>DocumentWriter：将文档列表保存到存储中（可以是向量数据库，也可以是其他存储）</li></ul><p><img src="'+u+'" alt="img" loading="lazy"></p><p>刚开始学习 RAG，我们不需要关注太多 ETL 的细节、也不用对文档进行特殊处理，下面我们就先用 Spring AI 读取准备好的 Markdown 文档，为写入到向量数据库做准备。</p><p>1）引入依赖</p><p>Spring AI 提供了很多种 DocumentReaders，用于加载不同类型的文件。</p><p><img src="'+A+`" alt="img" loading="lazy"></p><p>我们可以使用 <a href="https://docs.spring.io/spring-ai/reference/api/etl-pipeline.html#_markdown" target="_blank" rel="noreferrer">MarkdownDocumentReader</a> 来读取 Markdown 文档。需要先引入依赖，可以在 <a href="https://mvnrepository.com/artifact/org.springframework.ai/spring-ai-markdown-document-reader" target="_blank" rel="noreferrer">Maven 中央仓库</a> 找到（官方都没有提）。</p><div class="language-xml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;org.springframework.ai&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;spring-ai-markdown-document-reader&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;1.0.0-M6&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>2）在根目录下新建 <code>rag</code> 包，编写文档加载器类 LoveAppDocumentLoader，负责读取所有 Markdown 文档并转换为 Document 列表。代码如下：</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Component</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Slf4j</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> LoveAppDocumentLoader</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ResourcePatternResolver resourcePatternResolver;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    LoveAppDocumentLoader</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ResourcePatternResolver </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">resourcePatternResolver</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.resourcePatternResolver </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> resourcePatternResolver;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Document</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">loadMarkdowns</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Document</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; allDocuments </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ArrayList&lt;&gt;();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // 这里可以修改为你要加载的多个 Markdown 文件的路径模式</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            Resource</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[] resources </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> resourcePatternResolver.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getResources</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;classpath:document/*.md&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (Resource resource </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> resources) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                String fileName </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> resource.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getFilename</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                MarkdownDocumentReaderConfig config </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MarkdownDocumentReaderConfig.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">builder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">withHorizontalRuleCreateDocument</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">withIncludeCodeBlock</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">withIncludeBlockquote</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">withAdditionalMetadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;filename&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, fileName)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                MarkdownDocumentReader reader </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MarkdownDocumentReader</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(resource, config);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                allDocuments.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addAll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(reader.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (IOException </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            log.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Markdown 文档加载失败&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, e);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> allDocuments;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>上述代码中，我们通过 MarkdownDocumentReaderConfig 文档加载配置来指定读取文档的细节，比如是否读取代码块、引用块等。特别需要注意的是，我们还指定了额外的元信息配置，提取文档的文件名（fileName）作为文档的元信息，可以便于后续知识库实现更精确的检索。</p><p><img src="`+F+'" alt="img" loading="lazy"></p><h3 id="_3、向量转换和存储" tabindex="-1">3、向量转换和存储 <a class="header-anchor" href="#_3、向量转换和存储" aria-label="Permalink to &quot;3、向量转换和存储&quot;">​</a></h3><p>为了实现方便，我们先使用 Spring AI 内置的、基于内存读写的向量数据库 SimpleVectorStore 来保存文档。</p><p>SimpleVectorStore 实现了 VectorStore 接口，而 VectorStore 接口集成了 DocumentWriter，所以具备文档写入能力。如图：</p><p><img src="'+_+'" alt="img" loading="lazy"></p><p>简单了解下源码，在将文档写入到数据库前，会先调用 Embedding 大模型将文档转换为向量，实际保存到数据库中的是向量类型的数据。</p><p><img src="'+v+`" alt="img" loading="lazy"></p><p>在 <code>rag</code> 包下新建 LoveAppVectorStoreConfig 类，实现初始化向量数据库并且保存文档的方法。代码如下：</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Configuration</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> LoveAppVectorStoreConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Resource</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LoveAppDocumentLoader loveAppDocumentLoader;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Bean</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    VectorStore </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">loveAppVectorStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(EmbeddingModel </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dashscopeEmbeddingModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        SimpleVectorStore simpleVectorStore </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SimpleVectorStore.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">builder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dashscopeEmbeddingModel)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 加载文档</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Document</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; documents </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> loveAppDocumentLoader.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">loadMarkdowns</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        simpleVectorStore.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(documents);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> simpleVectorStore;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="_4、查询增强" tabindex="-1">4、查询增强 <a class="header-anchor" href="#_4、查询增强" aria-label="Permalink to &quot;4、查询增强&quot;">​</a></h3><p>Spring AI 通过 Advisor 特性提供了开箱即用的 RAG 功能。主要是 QuestionAnswerAdvisor 问答拦截器和 RetrievalAugmentationAdvisor 检索增强拦截器，前者更简单易用、后者更灵活强大。</p><p>查询增强的原理其实很简单。向量数据库存储着 AI 模型本身不知道的数据，当用户问题发送给 AI 模型时，QuestionAnswerAdvisor 会查询向量数据库，获取与用户问题相关的文档。然后从向量数据库返回的响应会被附加到用户文本中，为 AI 模型提供上下文，帮助其生成回答。</p><p>查看 QuestionAnswerAdvisor 源码，可以看到让 AI 基于知识库进行问答的 Prompt：</p><p><img src="`+D+`" alt="img" loading="lazy"></p><p>根据 <a href="https://docs.spring.io/spring-ai/reference/api/retrieval-augmented-generation.html" target="_blank" rel="noreferrer">官方文档</a>，需要先引入依赖（但鱼皮操作过程中发现，不引入也可以正常使用）：</p><div class="language-xml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;org.springframework.ai&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;spring-ai-advisors-vector-store&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>此处我们就选用更简单易用的 QuestionAnswerAdvisor 问答拦截器，在 <code>LoveApp</code> 中新增和 RAG 知识库进行对话的方法。代码如下：</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Resource</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> VectorStore loveAppVectorStore;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">doChatWithRag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(String message, String chatId) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ChatResponse chatResponse </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> chatClient</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">prompt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">user</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(message)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">advisors</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(spec </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> spec.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">param</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(CHAT_MEMORY_CONVERSATION_ID_KEY, chatId)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">param</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(CHAT_MEMORY_RETRIEVE_SIZE_KEY, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // 开启日志，便于观察效果</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">advisors</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyLoggerAdvisor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // 应用知识库问答</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">advisors</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> QuestionAnswerAdvisor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(loveAppVectorStore))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">call</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chatResponse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    String content </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> chatResponse.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getOutput</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getText</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    log.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content: {}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, content);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> content;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="测试" tabindex="-1">测试 <a class="header-anchor" href="#测试" aria-label="Permalink to &quot;测试&quot;">​</a></h3><p>编写单元测试代码，故意提问一个文档内有回答的问题：</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Test</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> doChatWithRag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    String chatId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> UUID.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">randomUUID</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    String message </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;我已经结婚了，但是婚后关系不太亲密，怎么办？&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    String answer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  loveApp.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">doChatWithRag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(message, chatId);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Assertions.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">assertNotNull</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(answer);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>运行程序，通过 Debug 发现，加载的文档被自动按照小标题拆分，并且补充了 metadata 元信息：</p><p><img src="`+C+'" alt="img" loading="lazy"></p><p>查看请求，发现根据用户的问题检索到了 4 个文档切片，每个切片有对应的分数和元信息：</p><p><img src="'+R+'" alt="img" loading="lazy"></p><p><img src="'+f+'" alt="img" loading="lazy"></p><p>查看请求，发现用户的提示词被修改了，让 AI 检索知识库：</p><p><img src="'+w+'" alt="img" loading="lazy"></p><p>查看响应结果，AI 的回复成功包含了知识库里的内容：</p><p><img src="'+I+'" alt="img" loading="lazy"></p>',134)])])}const L=i(B,[["render",q]]);export{z as __pageData,L as default};
