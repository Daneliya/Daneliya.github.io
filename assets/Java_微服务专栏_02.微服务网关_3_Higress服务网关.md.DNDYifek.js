import{_ as a,c as t,o as i,aN as e}from"./chunks/framework.CMIDsdwV.js";const r="/assets/O1CN01yvRXRl1Ux42Nd4bos_!!6000000002583-2-tps-1904-908.CpaeTHtk.png",p="/assets/O1CN01TtjqnE1vLVBDlhiJf_!!6000000006156-2-tps-1904-970.Wq-UUd_v.png",l="/assets/O1CN01v4ZbCj1dBjePSMZ17_!!6000000003698-0-tps-1613-926.BfA78bQI.jpg",o="/assets/image-20260111221022275.CozqU-pG.png",n="/assets/image-20260111221932110.B-hBgyoL.png",d="/assets/image-20260111222930309.BG4cnt97.png",g="/assets/image-20260111222206392.BzU9Ipvo.png",h="/assets/image-20260111223730505.DGE203ZR.png",c="/assets/V78os1nWqpJdGuma.W2EPBjJN.webp",m="/assets/image-20260111223202468.BnVNUQzm.png",k="/assets/coGMn7P7UAnJgNdi.BToDykpD.webp",_="/assets/CbXU0Mifj5GFDfFF.DrFtBbFT.webp",b="/assets/mmNP32Q8zg2ubgz4.CQZyRxgQ.webp",u="/assets/7wyta6AolF2Qf4Wl.7l0Vw2F1.webp",y="/assets/aZQyG7KlYZWMgDG6.BKRVsKm7.webp",F="/assets/H6lQbSPDGS0gTURY.Cm4XtojI.png",C="/assets/9z3iPkV4XKnkNuSk.CUZGwuWw.webp",w="/assets/EYkuOBJB70ldJhKf.ZQk6U2zG.webp",f="/assets/93bfEyc8AwtHBJ65.BNFttHDY.webp",z="/assets/hwtRrnIwAPCTAkjm.sg8XI1uJ.webp",B="/assets/byueUir8Ak0kQn99.Bnu0EpuN.webp",H="/assets/4o0SLh1i9UotZYR7.t_EnRfdn.webp",P="/assets/w5hu2NPuxwlIzyNS.DCfivzVr.webp",D="/assets/uPZQfuJcoDE9aEDu.Q-PXfoAQ.webp",x="/assets/G04GnWouM2Ntfh9q.DUFXGgH9.webp",q="/assets/1IGJUG5rIAjdwmtT.EDUWVHbo.webp",v="/assets/EuhqM5gExjIdCvh8.B3hPdWtR.webp",A="/assets/9PDeph8E6cgF6gow.DZcnehTx.webp",E="/assets/xNlDg7znBYmXFH0X.Du2AVwNi.webp",I="/assets/DnG0pmbonyZE6BhY.DztrEyJn.webp",Q=JSON.parse('{"title":"Higress服务网关","description":"","frontmatter":{"title":"Higress服务网关","permalink":"/java/mse/higress","tags":["Higress"],"categories":["Higress"]},"headers":[],"relativePath":"Java/微服务专栏/02.微服务网关/3_Higress服务网关.md","filePath":"Java/微服务专栏/02.微服务网关/3_Higress服务网关.md","lastUpdated":1768146130000}'),S={name:"Java/微服务专栏/02.微服务网关/3_Higress服务网关.md"};function N(G,s,T,J,U,W){return i(),t("div",null,[...s[0]||(s[0]=[e('<div style="display:none;" hidden="true" aria-hidden="true">Are you an LLM? You can read better optimized documentation at /Java\\微服务专栏\\02.微服务网关\\3_Higress服务网关.md for this page in Markdown format</div><h1 id="higress服务网关" tabindex="-1">Higress服务网关 <a class="header-anchor" href="#higress服务网关" aria-label="Permalink to &quot;Higress服务网关&quot;">​</a></h1><h2 id="一、higress-是什么" tabindex="-1">一、Higress 是什么 <a class="header-anchor" href="#一、higress-是什么" aria-label="Permalink to &quot;一、Higress 是什么&quot;">​</a></h2><h3 id="简介" tabindex="-1">简介 <a class="header-anchor" href="#简介" aria-label="Permalink to &quot;简介&quot;">​</a></h3><p>Higress 是基于阿里内部多年 Envoy Gateway 实践的 <strong>云原生 + AI 原生</strong> API 网关，采用 C++ 实现，相比传统的 Java 网关具有更高的性能和更低的内存占用，而且能够和 Nacos 和 Dubbo 轻松集成。</p><p>什么是 AI 原生呢？可以看看 <a href="https://higress.cn/docs/latest/overview/what-is-higress/" target="_blank" rel="noreferrer">官方对 AI 网关的介绍</a>，简单来说，Higress 支持多种 AI 协议，提供 AI 可观测性、AI 代理缓存、AI 令牌限流、AI 大模型对接等能力。</p><table tabindex="0"><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>传统 API 网关</td><td><img src="'+r+'" alt="img" loading="lazy"></td></tr><tr><td>AI 场景</td><td><img src="'+p+'" alt="img" loading="lazy"></td></tr></tbody></table><h3 id="对比" tabindex="-1">对比 <a class="header-anchor" href="#对比" aria-label="Permalink to &quot;对比&quot;">​</a></h3><p>下面是 H‍igress 与 ‌Spring Cl‍oud Gatew‍ay 的详细对比：</p><table tabindex="0"><thead><tr><th>对比项</th><th>Spring Cloud Gateway</th><th>Higress</th></tr></thead><tbody><tr><td>性能</td><td>中等 (基于 Spring WebFlux)</td><td>高 (基于 Envoy C++)</td></tr><tr><td>内存占用</td><td>较高 (JVM)</td><td>较低 (C++)</td></tr><tr><td>配置方式</td><td>代码 +‍ 配置文件</td><td>控制台 + 配置文件</td></tr><tr><td>插件生‌态</td><td>Spring 生态</td><td>Envoy ‍+ 自定义插件</td></tr><tr><td>可观测性</td><td>依赖 Spri‍ng Actuator</td><td>内置丰富的监控指‍标</td></tr><tr><td>云原生</td><td>支持</td><td>原生云原生设计</td></tr><tr><td>学习成本</td><td>低 (熟悉 Spring)</td><td>中等</td></tr><tr><td>AI 支持‍</td><td>需要自定义开‌发</td><td>原生 AI‍ 功能支持</td></tr></tbody></table><p>不过如何你需要在‍网关中写一些业务逻辑，Higr‌ess 可能就不适合了，而 S‍pring Cloud Gat‍eway 是可以在代码中引入并‍且自定义 Java 业务逻辑的。</p><h3 id="核心功能" tabindex="-1">核心功能 <a class="header-anchor" href="#核心功能" aria-label="Permalink to &quot;核心功能&quot;">​</a></h3><p>作为系统的‍统一入口，Higr‌ess 网关为我们‍提供了以下核心能力‍：</p><ul><li>统一入口：为所有微服务提供统一的访问入口，简化客户端的调用复杂度。</li><li>请求路由：根据请求的路径、参数等信息，将请求路由到正确的微服务实例。</li><li>负载均衡：在多个服务实例之间分发请求，提高系统的可用性和性能。</li><li>安全认证：统一处理身份验证、权限控制等安全相关功能。</li><li>限流熔断：实现请求限流、服务熔断等保护机制，防止系统过载。</li><li>监控日志：收集请求日志、监控指标等信息，便于系统运维和问题排查</li></ul><p><img src="'+l+'" alt="img" loading="lazy"></p><h2 id="二、higress-安装" tabindex="-1">二、Higress 安装 <a class="header-anchor" href="#二、higress-安装" aria-label="Permalink to &quot;二、Higress 安装&quot;">​</a></h2><p>Higre‍ss 的安装需要 ‌Docker 环境‍支持，如果没有安装‍ Docker 的‍话，必须先安装！</p><p>推荐直接 <a href="https://www.docker.com/products/docker-desktop/" target="_blank" rel="noreferrer">安装 Docker Desktop</a>，会自动安装 Docker 以及可视化管理软件。</p><p>但是要注意，Windows 上想运行 Docker 的话，必须要安装 WSL（Linux 子系统），<a href="https://learn.microsoft.com/zh-cn/windows/wsl/install" target="_blank" rel="noreferrer">参考官方安装文档</a>。</p><p><img src="'+o+'" alt="image-20260111221022275" loading="lazy"></p><p>不过由于安装时可能会出现“与服务器的连接被重置”，建议直接到 <a href="https://github.com/microsoft/WSL/releases" target="_blank" rel="noreferrer">GitHub 下载 WSL 安装包</a>：</p><p><img src="'+n+`" alt="image-20260111221932110" loading="lazy"></p><p>注意，如果实在无法安装 WSL，也可以用虚拟机软件。</p><p>安装好 D‍ocker 后，可‌以使用以下命令在本‍地启动 Higre‍ss：</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> higress-ai</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \${PWD}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:/data</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -e</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> O11Y=on</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 8001:8001</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 8080:8080</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 8443:8443</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        higress-registry.cn-hangzhou.cr.aliyuncs.com/higress/all-in-one:latest</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>监听端口说明：</p><ul><li>8001 端口：Higress UI 控制台入口</li><li>8080 端口：网关 HTTP 协议入口</li><li>8443 端口：网关 HTTPS 协议入口</li></ul><p>可以用 <code>docker ps</code> 命令查看启动状态：</p><p><img src="`+d+'" alt="image-20260111222930309" loading="lazy"></p><p>Docker Desktop 中能看到运行的容器：</p><p><img src="'+g+'" alt="image-20260111222206392" loading="lazy"></p><p>启动成功后，‍可以通过 8001 端口‌访问 Higress 控‍制台：</p><p><img src="'+h+'" alt="image-20260111223730505" loading="lazy"></p><h2 id="三、服务来源配置" tabindex="-1">三、服务来源配置 <a class="header-anchor" href="#三、服务来源配置" aria-label="Permalink to &quot;三、服务来源配置&quot;">​</a></h2><p>在 Hig‍ress 控制台中‌配置服务来源，可以‍从 Nacos 中‍获取服务来源：</p><p><img src="'+c+'" alt="img" loading="lazy"></p><p>需要注意的‍是，注册中心地址不‌支持 127.0.‍0.1 或 loc‍alhost，需要‍使用本机的内网地址。</p><p>Windows 系统通过 <code>ipconfig</code> 命令查看：</p><p><img src="'+m+'" alt="image-20260111223202468" loading="lazy"></p><p>Mac 系统可以直接在网络设置中查看：</p><p><img src="'+k+'" alt="img" loading="lazy"></p><p>配置完成后‍，Higress ‌会自动发现在 Na‍cos 中注册的所‍有微服务：</p><p><img src="'+_+'" alt="img" loading="lazy"></p><p>但是 Dubbo + Nacos 默认只注册 Dubbo 服务（RPC接口），而不注册 HTTP 接口。我们对外提供的服务都没有被发现，需要手动注册：</p><p><img src="'+b+'" alt="img" loading="lazy"></p><p>所有服务注册完成：</p><p><img src="'+u+'" alt="img" loading="lazy"></p><h2 id="四、路由配置" tabindex="-1">四、路由配置 <a class="header-anchor" href="#四、路由配置" aria-label="Permalink to &quot;四、路由配置&quot;">​</a></h2><p>手动配置路由规则，为每个服务创建对应的路由：</p><p><img src="'+y+'" alt="img" loading="lazy"></p><p>选择对应的服务并配置路由规则：</p><p><img src="'+F+'" alt="img" loading="lazy"></p><p>这样一来，前端只需要访问网关的地址 <code>localhost:8080/api/user/xxx</code>，就会自动转发到对应的服务 <code>localhost:8124/api/user/xxx</code>。</p><p>路由配置完成：</p><p><img src="'+C+'" alt="img" loading="lazy"></p><p>完成路由配置后‍，需要修改前端 vite ‌请求代理地址为 8080 ‍端口，然后就可以利用前端来‍测试完整业务流程了，能正常‍登录和生成网站就说明配置成功。</p><p>💡 如果你使用了 Spring Cloud 作为服务发现（而不是 Dubbo），可以 <a href="https://nacos.io/docs/latest/ecology/use-nacos-with-spring-cloud" target="_blank" rel="noreferrer">整合 Nacos 快速发现服务</a>。</p><h2 id="五、插件配置" tabindex="-1">五、插件配置 <a class="header-anchor" href="#五、插件配置" aria-label="Permalink to &quot;五、插件配置&quot;">​</a></h2><p>Higre‍ss 提供了丰富的‌插件功能，可以满足‍不同场景的需求。分享一些典型的‍场景：</p><h3 id="cors-跨域配置" tabindex="-1">CORS 跨域配置 <a class="header-anchor" href="#cors-跨域配置" aria-label="Permalink to &quot;CORS 跨域配置&quot;">​</a></h3><p>可以全局配置 CORS 跨域支持：</p><p><img src="'+w+'" alt="img" loading="lazy"></p><p>支持表单填写或者 YAML 配置文件：</p><p><img src="'+f+'" alt="img" loading="lazy"></p><p>也可以单独针对某个路由配置跨域插件：</p><p><img src="'+z+'" alt="img" loading="lazy"></p><p>如图：</p><p><img src="'+B+'" alt="img" loading="lazy"></p><p><img src="'+H+'" alt="img" loading="lazy"></p><h3 id="权限认证插件" tabindex="-1">权限认证插件 <a class="header-anchor" href="#权限认证插件" aria-label="Permalink to &quot;权限认证插件&quot;">​</a></h3><p>Higress 提供了多种权限认证插件：</p><p><img src="'+P+'" alt="img" loading="lazy"></p><p>比如 Ke‍y 认证是一个典型‌的 API 认证场‍景（想想调用 AI‍ 时输入的 API‍ Key）：</p><p><img src="'+D+'" alt="img" loading="lazy"></p><h3 id="安全性插件" tabindex="-1">安全性插件 <a class="header-anchor" href="#安全性插件" aria-label="Permalink to &quot;安全性插件&quot;">​</a></h3><p>可以配置 IP 限制、请求屏蔽等安全插件：</p><p><img src="'+x+'" alt="img" loading="lazy"></p><p>比如限制禁止某个 IP 访问：</p><p><img src="'+q+'" alt="img" loading="lazy"></p><p>还可以利用请求屏蔽插件提高安全性。测试一下，禁止访问 <code>/api/user/get/login</code> 接口：</p><p><img src="'+v+'" alt="img" loading="lazy"></p><p>配置后该接‍口会返回 404，‌因为被网关拦截了，‍都到不了用户服务：</p><p><img src="'+A+'" alt="img" loading="lazy"></p><h3 id="限流插件" tabindex="-1">限流插件 <a class="header-anchor" href="#限流插件" aria-label="Permalink to &quot;限流插件&quot;">​</a></h3><p>还可以配置限流插件，在网关层面控制请求频率：</p><p><img src="'+E+'" alt="img" loading="lazy"></p><p>比较常用的是‍基于 Key 进行限流‌，Key 可以从请求头‍或 URL 参数中获取‍，比如根据请求参数中的‍ appId 限流。</p><p><img src="'+I+'" alt="img" loading="lazy"></p>',88)])])}const V=a(S,[["render",N]]);export{Q as __pageData,V as default};
