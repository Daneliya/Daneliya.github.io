import{_ as a,c as i,o as e,ah as l}from"./chunks/framework.D5cOWG0Y.js";const c=JSON.parse('{"title":"EFK篇之Filebeat使用","description":"","frontmatter":{"title":"EFK篇之Filebeat使用","tags":["分布式日志收集","Filebeat"],"categories":["分布式日志收集","Filebeat"]},"headers":[],"relativePath":"Java/架构设计/分布式/分布式日志收集/4_EFK篇之Filebeat使用.md","filePath":"Java/架构设计/分布式/分布式日志收集/4_EFK篇之Filebeat使用.md","lastUpdated":1755802517000}'),n={name:"Java/架构设计/分布式/分布式日志收集/4_EFK篇之Filebeat使用.md"};function t(p,s,r,h,k,o){return e(),i("div",null,[...s[0]||(s[0]=[l(`<h2 id="efk概述" tabindex="-1"><strong>EFK</strong>概述 <a class="header-anchor" href="#efk概述" aria-label="Permalink to “EFK概述”">​</a></h2><p>主流的 ELK (Elasticsearch, Logstash, Kibana) 目前已经转变为 EFK (Elasticsearch, Filebeat or Fluentd, Kibana) 比较重，对于容器云的日志方案业内也普遍推荐采用 Fluentd。</p><p>一个典型的 ELK 方案下的日志收集处理流程：</p><ul><li>Logstash 从各个 Docker 容器中提取日志信息</li><li>Logstash 将日志转发到 Elasticsearch 进行索引和保存</li><li>Kibana 负责分析和可视化日志信息</li></ul><p>由于 Logstash 在数据收集上并不出色，而且作为 Agent，其性能并不达标。基于此，Elastic 发布了 beats 系列轻量级采集组件。</p><p>这里我们要实践的 Beat 组件是 Filebeat，Filebeat 是构建于 beats 之上的，应用于日志收集场景的实现，用来替代 Logstash Forwarder 的下一代 Logstash 收集器，是为了更快速稳定轻量低耗地进行收集工作，它可以很方便地与 Logstash 还有直接与 Elasticsearch 进行对接。</p><p>Filebeat 作为 Agent，它会收集的 log 文件中的记录变动，并直接将日志发给 Elasticsearch 进行索引和保存。</p><h2 id="filebeat、logstash、fluentd-三者的区别和联系" tabindex="-1"><strong>Filebeat、Logstash、Fluentd 三者的区别和联系</strong> <a class="header-anchor" href="#filebeat、logstash、fluentd-三者的区别和联系" aria-label="Permalink to “Filebeat、Logstash、Fluentd 三者的区别和联系”">​</a></h2><p>Filebeat 是一个轻量级的收集本地 log 数据的方案，官方对 Filebeats 的说明如下。</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Filebeat is a log data shipper for local files. Installed as an agent on your servers, Filebeat monitors the log directories or specific log files, tails the files, and forwards them either to Elasticsearch or Logstash for indexing</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>可以看出 Filebeat 功能比较单一，它仅仅只能收集本地的 log，但并不能对收集到的 Log 做什么处理，所以通常 Filebeat 通常需要将收集到的 log 发送到 Logstash 做进一步的处理。相比Logstash用Filebeats只需要一步搞定，而且不需要考虑代码侵入。</p><p>Logstash 和 Fluentd 都具有收集并处理 log 的能力，功能上二者旗鼓相当，但 Logstash 消耗更多的 memory，对此 Logstash 的解决方案是使用 Filebeats 从各个叶子节点上收集 log，当然 Fluentd 也有对应的 Fluent Bit。</p><p>另外一个重要的区别是 Fluentd 抽象性做得更好，对用户屏蔽了底层细节的繁琐。作者的原话如下：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Fluentd’s approach is more declarative whereas Logstash’s method is procedural. For programmers trained in procedural programming, Logstash’s configuration can be easier to get started. On the other hand, Fluentd’s tag-based routing allows complex routing to be expressed cleanly.</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>虽然作者说是要中立的对二者（Logstash 和 Fluentd）进行对比，但实际上偏向性很明显了：）。</p><p>Filebeat、Logstash、Elasticsearch 和 Kibana 是属于同一家公司的开源项目，官方文档如下：</p><blockquote><p><a href="https://www.elastic.co/guide/index.html" target="_blank" rel="noreferrer">https://www.elastic.co/guide/index.html</a></p></blockquote><p>Fluentd 则是另一家公司的开源项目，官方文档如下：</p><blockquote><p><a href="https://docs.fluentd.org" target="_blank" rel="noreferrer">https://docs.fluentd.org</a></p></blockquote><h2 id="filebeat-配置" tabindex="-1"><strong>Filebeat 配置</strong> <a class="header-anchor" href="#filebeat-配置" aria-label="Permalink to “Filebeat 配置”">​</a></h2><blockquote><p>下载地址：<a href="https://www.elastic.co/cn/downloads/beats/filebeat" target="_blank" rel="noreferrer">https://www.elastic.co/cn/downloads/beats/filebeat</a></p></blockquote><p>下载</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pull</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker.elastic.co/beats/filebeat:7.17.15</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>新建配置文件<code>filebeat.docker.yml</code>，路径<code>/home/tools/filebeat</code></p><blockquote><p>官方默认配置文件：<a href="https://raw.githubusercontent.com/elastic/beats/7.17/deploy/docker/filebeat.docker.yml" target="_blank" rel="noreferrer">https://raw.githubusercontent.com/elastic/beats/7.17/deploy/docker/filebeat.docker.yml</a></p></blockquote><div class="language-yml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yml</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 日志输入配置</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">filebeat.inputs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">log</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  paths</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 需要收集的日志所在的位置，可使用通配符进行配置</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  #- /data/elk/*.log</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/home/springboot/*/*.log</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#日志输出配置(采用 logstash 收集日志，5044为logstash端口)</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">output.logstash</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  hosts</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;192.168.64.128:5044&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>启动</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --restart=always</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--log-driver </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">json-file</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--log-opt </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">max-size=100m</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--log-opt </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">max-file=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--name </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">filebeat</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--user=root </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-d</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-v </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/logs/:/logs/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-v </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/home/tools/filebeat/filebeat.docker.yml:/usr/share/filebeat/filebeat.yml</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">docker.elastic.co/beats/filebeat:7.17.15</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>重启容器</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>systemctl restart filebeat</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>进入 Kibana 中查看日志信息，便可以看到刚刚添加的容器的日志信息了。</p><h2 id="参考资料" tabindex="-1">参考资料 <a class="header-anchor" href="#参考资料" aria-label="Permalink to “参考资料”">​</a></h2><p>[1]. 公众号【奇妙的Linux世界】一文读懂开源日志管理方案 ELK 和 EFK 的区别</p><p>[2]. <a href="https://zhuanlan.zhihu.com/p/141439013" target="_blank" rel="noreferrer">https://zhuanlan.zhihu.com/p/141439013</a></p><p>[3]. <a href="https://blog.csdn.net/zyxwvuuvwxyz/article/details/108831962" target="_blank" rel="noreferrer">https://blog.csdn.net/zyxwvuuvwxyz/article/details/108831962</a></p><p>[4]. <a href="https://www.bilibili.com/video/BV18u4y1e7rs" target="_blank" rel="noreferrer">https://www.bilibili.com/video/BV18u4y1e7rs</a></p>`,36)])])}const b=a(n,[["render",t]]);export{c as __pageData,b as default};
